import axios from "./Axios";
import { of, from, forkJoin, throwError, Observable } from "rxjs";
import { switchMap, map, tap, catchError, reduce } from "rxjs/operators";
import moment from "moment";

import { apiKey } from "./config";

const url = ({ symbol, fromDate, toDate }) =>
  `https://financialmodelingprep.com/api/v3/historical-price-full/${symbol}?from=${fromDate}&to=${toDate}&apikey=${apiKey}`;

const historicalPriceByRange = (query) => {
  return from(axios.get(`${url(query)}`)).pipe(
    map((res) => res.data),
    catchError((error) => {
      return of({ message: "Server Error" });
    })
  );
  // return of(dummydata());
};

export default historicalPriceByRange;

function dummydata() {
  return {
    symbol: "ISRG",
    historical: [
      {
        date: "2021-04-01",
        open: 749.98999,
        high: 758.070007,
        low: 745.880005,
        close: 747.599976,
        adjClose: 747.599976,
        volume: 452600.0,
        unadjustedVolume: 452600.0,
        change: -2.39001,
        changePercent: -0.319,
        vwap: 750.51666,
        label: "April 01, 21",
        changeOverTime: -0.00319,
      },
      {
        date: "2021-03-31",
        open: 728.559998,
        high: 743.929993,
        low: 727.26001,
        close: 738.940002,
        adjClose: 738.940002,
        volume: 565100.0,
        unadjustedVolume: 565100.0,
        change: 10.38,
        changePercent: 1.425,
        vwap: 736.71,
        label: "March 31, 21",
        changeOverTime: 0.01425,
      },
      {
        date: "2021-03-30",
        open: 719.109985,
        high: 728.98999,
        low: 714.52002,
        close: 726.48999,
        adjClose: 726.48999,
        volume: 480800.0,
        unadjustedVolume: 480800.0,
        change: 7.38,
        changePercent: 1.026,
        vwap: 723.33333,
        label: "March 30, 21",
        changeOverTime: 0.01026,
      },
      {
        date: "2021-03-29",
        open: 729.450012,
        high: 734.140015,
        low: 717.330017,
        close: 723.950012,
        adjClose: 723.950012,
        volume: 450300.0,
        unadjustedVolume: 450300.0,
        change: -5.5,
        changePercent: -0.754,
        vwap: 725.14001,
        label: "March 29, 21",
        changeOverTime: -0.00754,
      },
      {
        date: "2021-03-26",
        open: 707.080017,
        high: 731.840027,
        low: 704.75,
        close: 730.75,
        adjClose: 730.75,
        volume: 569200.0,
        unadjustedVolume: 569200.0,
        change: 23.66998,
        changePercent: 3.348,
        vwap: 722.44668,
        label: "March 26, 21",
        changeOverTime: 0.03348,
      },
      {
        date: "2021-03-25",
        open: 710.650024,
        high: 714.419983,
        low: 693.619995,
        close: 704.5,
        adjClose: 704.5,
        volume: 460000.0,
        unadjustedVolume: 460000.0,
        change: -6.15002,
        changePercent: -0.865,
        vwap: 704.17999,
        label: "March 25, 21",
        changeOverTime: -0.00865,
      },
      {
        date: "2021-03-24",
        open: 712.0,
        high: 720.340027,
        low: 705.48999,
        close: 711.070007,
        adjClose: 711.070007,
        volume: 484000.0,
        unadjustedVolume: 484000.0,
        change: -0.92999,
        changePercent: -0.131,
        vwap: 712.30001,
        label: "March 24, 21",
        changeOverTime: -0.00131,
      },
      {
        date: "2021-03-23",
        open: 716.51001,
        high: 720.97998,
        low: 707.650024,
        close: 710.820007,
        adjClose: 710.820007,
        volume: 335000.0,
        unadjustedVolume: 335000.0,
        change: -5.69,
        changePercent: -0.794,
        vwap: 713.15,
        label: "March 23, 21",
        changeOverTime: -0.00794,
      },
      {
        date: "2021-03-22",
        open: 707.719971,
        high: 721.159973,
        low: 703.140015,
        close: 714.72998,
        adjClose: 714.72998,
        volume: 436600.0,
        unadjustedVolume: 436600.0,
        change: 7.01001,
        changePercent: 0.991,
        vwap: 713.00999,
        label: "March 22, 21",
        changeOverTime: 0.00991,
      },
      {
        date: "2021-03-19",
        open: 701.5,
        high: 714.719971,
        low: 695.390015,
        close: 707.48999,
        adjClose: 707.48999,
        volume: 792600.0,
        unadjustedVolume: 792600.0,
        change: 5.98999,
        changePercent: 0.854,
        vwap: 705.86666,
        label: "March 19, 21",
        changeOverTime: 0.00854,
      },
      {
        date: "2021-03-18",
        open: 715.719971,
        high: 719.570007,
        low: 695.059998,
        close: 699.320007,
        adjClose: 699.320007,
        volume: 646800.0,
        unadjustedVolume: 646800.0,
        change: -16.39996,
        changePercent: -2.291,
        vwap: 704.65,
        label: "March 18, 21",
        changeOverTime: -0.02291,
      },
      {
        date: "2021-03-17",
        open: 724.330017,
        high: 728.969971,
        low: 712.799988,
        close: 724.640015,
        adjClose: 724.640015,
        volume: 352200.0,
        unadjustedVolume: 352200.0,
        change: 0.31,
        changePercent: 0.043,
        vwap: 722.13666,
        label: "March 17, 21",
        changeOverTime: 4.3e-4,
      },
      {
        date: "2021-03-16",
        open: 740.409973,
        high: 741.5,
        low: 721.51001,
        close: 726.630005,
        adjClose: 726.630005,
        volume: 425800.0,
        unadjustedVolume: 425800.0,
        change: -13.77997,
        changePercent: -1.861,
        vwap: 729.88001,
        label: "March 16, 21",
        changeOverTime: -0.01861,
      },
      {
        date: "2021-03-15",
        open: 727.320007,
        high: 737.549988,
        low: 725.049988,
        close: 735.059998,
        adjClose: 735.059998,
        volume: 400900.0,
        unadjustedVolume: 400900.0,
        change: 7.73999,
        changePercent: 1.064,
        vwap: 732.55332,
        label: "March 15, 21",
        changeOverTime: 0.01064,
      },
      {
        date: "2021-03-12",
        open: 721.119995,
        high: 736.409973,
        low: 720.0,
        close: 733.98999,
        adjClose: 733.98999,
        volume: 489100.0,
        unadjustedVolume: 489100.0,
        change: 12.87,
        changePercent: 1.785,
        vwap: 730.13332,
        label: "March 12, 21",
        changeOverTime: 0.01785,
      },
      {
        date: "2021-03-11",
        open: 730.359985,
        high: 738.97998,
        low: 724.359985,
        close: 732.0,
        adjClose: 732.0,
        volume: 497600.0,
        unadjustedVolume: 497600.0,
        change: 1.64001,
        changePercent: 0.225,
        vwap: 731.77999,
        label: "March 11, 21",
        changeOverTime: 0.00225,
      },
      {
        date: "2021-03-10",
        open: 720.97998,
        high: 727.609985,
        low: 712.830017,
        close: 719.809998,
        adjClose: 719.809998,
        volume: 732700.0,
        unadjustedVolume: 732700.0,
        change: -1.16998,
        changePercent: -0.162,
        vwap: 720.08333,
        label: "March 10, 21",
        changeOverTime: -0.00162,
      },
      {
        date: "2021-03-09",
        open: 697.539978,
        high: 710.25,
        low: 690.01001,
        close: 702.799988,
        adjClose: 702.799988,
        volume: 696800.0,
        unadjustedVolume: 696800.0,
        change: 5.26001,
        changePercent: 0.754,
        vwap: 701.02,
        label: "March 09, 21",
        changeOverTime: 0.00754,
      },
      {
        date: "2021-03-08",
        open: 705.349976,
        high: 710.570007,
        low: 682.400024,
        close: 684.900024,
        adjClose: 684.900024,
        volume: 639200.0,
        unadjustedVolume: 639200.0,
        change: -20.44995,
        changePercent: -2.899,
        vwap: 692.62335,
        label: "March 08, 21",
        changeOverTime: -0.02899,
      },
      {
        date: "2021-03-05",
        open: 712.25,
        high: 718.440002,
        low: 687.23999,
        close: 713.369995,
        adjClose: 713.369995,
        volume: 759100.0,
        unadjustedVolume: 759100.0,
        change: 1.12,
        changePercent: 0.157,
        vwap: 706.35,
        label: "March 05, 21",
        changeOverTime: 0.00157,
      },
      {
        date: "2021-03-04",
        open: 725.0,
        high: 727.23999,
        low: 699.030029,
        close: 709.169983,
        adjClose: 709.169983,
        volume: 809200.0,
        unadjustedVolume: 809200.0,
        change: -15.83002,
        changePercent: -2.183,
        vwap: 711.81333,
        label: "March 04, 21",
        changeOverTime: -0.02183,
      },
      {
        date: "2021-03-03",
        open: 746.059998,
        high: 746.059998,
        low: 721.47998,
        close: 727.150024,
        adjClose: 727.150024,
        volume: 507100.0,
        unadjustedVolume: 507100.0,
        change: -18.90997,
        changePercent: -2.535,
        vwap: 731.56333,
        label: "March 03, 21",
        changeOverTime: -0.02535,
      },
      {
        date: "2021-03-02",
        open: 760.0,
        high: 760.0,
        low: 746.780029,
        close: 750.0,
        adjClose: 750.0,
        volume: 391000.0,
        unadjustedVolume: 391000.0,
        change: -10.0,
        changePercent: -1.316,
        vwap: 752.26001,
        label: "March 02, 21",
        changeOverTime: -0.01316,
      },
      {
        date: "2021-03-01",
        open: 749.039978,
        high: 760.77002,
        low: 745.669983,
        close: 759.210022,
        adjClose: 759.210022,
        volume: 559200.0,
        unadjustedVolume: 559200.0,
        change: 10.17004,
        changePercent: 1.358,
        vwap: 755.21668,
        label: "March 01, 21",
        changeOverTime: 0.01358,
      },
      {
        date: "2021-02-26",
        open: 743.900024,
        high: 747.700012,
        low: 726.309998,
        close: 736.799988,
        adjClose: 736.799988,
        volume: 669000.0,
        unadjustedVolume: 669000.0,
        change: -7.10004,
        changePercent: -0.954,
        vwap: 736.93667,
        label: "February 26, 21",
        changeOverTime: -0.00954,
      },
      {
        date: "2021-02-25",
        open: 754.859985,
        high: 758.890015,
        low: 731.900024,
        close: 741.789978,
        adjClose: 741.789978,
        volume: 445200.0,
        unadjustedVolume: 445200.0,
        change: -13.07001,
        changePercent: -1.731,
        vwap: 744.19334,
        label: "February 25, 21",
        changeOverTime: -0.01731,
      },
      {
        date: "2021-02-24",
        open: 743.72998,
        high: 759.669983,
        low: 738.289978,
        close: 758.710022,
        adjClose: 758.710022,
        volume: 440000.0,
        unadjustedVolume: 440000.0,
        change: 14.98004,
        changePercent: 2.014,
        vwap: 752.22333,
        label: "February 24, 21",
        changeOverTime: 0.02014,
      },
      {
        date: "2021-02-23",
        open: 742.0,
        high: 748.630005,
        low: 732.099976,
        close: 744.710022,
        adjClose: 744.710022,
        volume: 702000.0,
        unadjustedVolume: 702000.0,
        change: 2.71002,
        changePercent: 0.365,
        vwap: 741.81333,
        label: "February 23, 21",
        changeOverTime: 0.00365,
      },
      {
        date: "2021-02-22",
        open: 751.789978,
        high: 752.789978,
        low: 737.0,
        close: 741.400024,
        adjClose: 741.400024,
        volume: 637000.0,
        unadjustedVolume: 637000.0,
        change: -10.38995,
        changePercent: -1.382,
        vwap: 743.73,
        label: "February 22, 21",
        changeOverTime: -0.01382,
      },
      {
        date: "2021-02-19",
        open: 773.25,
        high: 773.25,
        low: 749.679993,
        close: 750.150024,
        adjClose: 750.150024,
        volume: 746300.0,
        unadjustedVolume: 746300.0,
        change: -23.09998,
        changePercent: -2.987,
        vwap: 757.69334,
        label: "February 19, 21",
        changeOverTime: -0.02987,
      },
      {
        date: "2021-02-18",
        open: 774.570007,
        high: 776.419983,
        low: 757.789978,
        close: 767.530029,
        adjClose: 767.530029,
        volume: 642700.0,
        unadjustedVolume: 642700.0,
        change: -7.03998,
        changePercent: -0.909,
        vwap: 767.24666,
        label: "February 18, 21",
        changeOverTime: -0.00909,
      },
    ],
  };
}
